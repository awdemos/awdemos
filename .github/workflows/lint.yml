name: Code Quality & Linting

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  yaml-lint:
    name: YAML Lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: yamllint
        uses: ibiqlik/action-yamllint@v3
        with:
          config_file: .yamllint
          format: github
          strict: true
          continue-on-error: false

  markdown-lint:
    name: Markdown Lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Lint Markdown files
        uses: articulate/actions-markdownlint@v1
        with:
          config: .markdownlint.json

  shellcheck:
    name: Shell Script Lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run ShellCheck
        uses: ludeeus/action-shellcheck@master

  dockerfile-lint:
    name: Dockerfile Lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Lint Dockerfiles
        uses: hadolint/hadolint-action@v3.1.0
        with:
          dockerfile: Dockerfile

  python-lint:
    name: Python Lint & Format
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install ruff black mypy
      - name: Run ruff
        run: |
          ruff check **/*.py || true
        continue-on-error: true

  go-lint:
    name: Go Lint & Format
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21'
      - name: Run golangci-lint
        uses: golangci/golangci-lint-action@v4
        with:
          version: latest
          only-new-issues: true
        continue-on-error: true

  rust-lint:
    name: Rust Lint & Format
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Rust Toolchain
        uses: dtolnay/rust-toolchain@stable
        with:
          components: rustfmt, clippy
      - name: Run cargo fmt
        run: cargo fmt -- --check
        continue-on-error: true
      - name: Run cargo clippy
        run: cargo clippy -- -D warnings
        continue-on-error: true

  license-check:
    name: License Header Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: License Checker
        uses: apache/skywalking-eyes/header@v0.5.0
        with:
          config: .licenserc.yaml
        continue-on-error: true

  summary:
    name: Quality Summary
    runs-on: ubuntu-latest
    needs: [yaml-lint, markdown-lint, shellcheck, dockerfile-lint, python-lint, go-lint, rust-lint, license-check]
    if: always()
    steps:
      - name: Quality Summary
        run: |
          echo "## Code Quality Report ðŸ“Š" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "All linting jobs completed!" >> $GITHUB_STEP_SUMMARY
